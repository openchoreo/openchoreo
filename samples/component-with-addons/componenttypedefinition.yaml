apiVersion: openchoreo.dev/v1alpha1
kind: ComponentTypeDefinition
metadata:
  name: simple-deployment
  namespace: default
spec:
  workloadType: deployment

  schema:
    # Parameters are static across environments
    parameters:
      imagePullPolicy: "string | default=IfNotPresent"
      replicas: "integer | default=1"

    # EnvOverrides can be overridden per environment
    envOverrides:
      resources:
        limits:
          cpu: "string | default=500m"
          memory: "string | default=512Mi"
        requests:
          cpu: "string | default=100m"
          memory: "string | default=256Mi"

  resources:
    - id: deployment
      template:
        apiVersion: apps/v1
        kind: Deployment
        metadata:
          name: ${metadata.name}
          namespace: ${metadata.namespace}
        spec:
          replicas: ${spec.replicas}
          selector:
            matchLabels:
              app: ${metadata.name}
          template:
            metadata:
              labels:
                app: ${metadata.name}
            spec:
              containers:
                - name: app
                  image: nginx:latest
                  imagePullPolicy: ${spec.imagePullPolicy}
                  resources:
                    limits:
                      cpu: ${spec.resources.limits.cpu}
                      memory: ${spec.resources.limits.memory}
                    requests:
                      cpu: ${spec.resources.requests.cpu}
                      memory: ${spec.resources.requests.memory}
